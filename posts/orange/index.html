<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Introducing OrangeDB: A Distributed Key-Doc Database | Open Notes</title><meta name=description content="Minimal notes"><link rel=canonical href=http://localhost:1313/opennotes/posts/orange/><meta property="og:title" content="Introducing OrangeDB: A Distributed Key-Doc Database"><meta property="og:description" content="Minimal notes"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/opennotes/posts/orange/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introducing OrangeDB: A Distributed Key-Doc Database"><meta name=twitter:description content="Minimal notes"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Introducing OrangeDB: A Distributed Key-Doc Database","url":"http:\/\/localhost:1313\/opennotes\/posts\/orange\/","datePublished":"2025-08-16T11:11:09\u002b05:30","dateModified":"2025-08-16T11:11:09\u002b05:30","author":{"@type":"Person","name":"Nagaraj"},"description":"Minimal notes"}</script><link rel=apple-touch-icon sizes=57x57 href=/opennotes/favicon_io/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/opennotes/favicon_io/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/opennotes/favicon_io/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/opennotes/favicon_io/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/opennotes/favicon_io/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/opennotes/favicon_io/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/opennotes/favicon_io/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/opennotes/favicon_io/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/opennotes/favicon_io/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/opennotes/favicon_io/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/opennotes/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/opennotes/favicon_io/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/opennotes/favicon_io/favicon-16x16.png><link rel=manifest href=/opennotes/favicon_io/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/opennotes/favicon_io/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/opennotes/css/main.min.383a7d1382f8498b5f1577cdce60b99b9a4f5c7b7aa954cbab4d0a7f85f73262.css integrity="sha256-ODp9E4L4SYtfFXfNzmC5m5pPXHt6qVTLq00Kf4X3MmI=" crossorigin=anonymous><link rel=stylesheet href=/opennotes/css/custom.min.da68636af3246ceae03c7f037fc6a3d62af522a10e883cac3ec8536110e0a023.css integrity="sha256-2mhjavMkbOrgPH8Df8aj1ir1IqEOiDysPshTYRDgoCM=" crossorigin=anonymous></head><body><a href=#main-content class=skip-link>Skip to content</a><header><nav class=path-nav><ol><li>/
<a href=/opennotes/>Open Notes</a>
/</li><li><a href=/opennotes/posts/>Posts</a>
/</li><li class=current><a href=/opennotes/posts/orange/>Introducing OrangeDB: A Distributed Key-Doc Database</a></li></ol></nav></header><main id=main-content><h1>Introducing OrangeDB: A Distributed Key-Doc Database</h1><div class=terms-list><ul><li><a href=/opennotes/tags/lsm-tree/>#LSM-Tree</a></li><li><a href=/opennotes/tags/distributed-database/>#Distributed-Database</a></li><li><a href=/opennotes/tags/replication/>#Replication</a></li><li><a href=/opennotes/tags/sharding/>#Sharding</a></li></ul></div><nav class=toc><strong>Table of contents</strong><div class=toc-content><nav id=TableOfContents><ul><li><a href=#what-makes-parrot-different>What Makes Parrot Different?</a></li><li><a href=#introducing-orangedb>Introducing <strong>OrangeDB</strong></a></li><li><a href=#sharding-consistency-and-replication>Sharding, Consistency, and Replication</a><ul><li></li></ul></li><li><a href=#deployment-options>Deployment Options</a><ul><li><a href=#standalone-mode>Standalone Mode</a></li><li><a href=#sharded-cluster-on-kubernetes>Sharded Cluster on Kubernetes</a></li></ul></li><li><a href=#whats-next>What&rsquo;s Next?</a></li></ul></nav></div></nav><p>A couple of months ago, I started building a small LSM tree-based storage engine, which I call <strong>Parrot</strong>.</p><p>If you&rsquo;re unfamiliar with LSM trees—unlike B-trees, which require frequent reorganizations—LSM (Log-Structured Merge) trees write data as sequential logs. One of the main problems with B/B+ trees is <strong>write amplification</strong>. Inserting a single row might trigger multiple rearrangements across various index trees, leading to costly <strong>random disk writes</strong>, especially in persistent systems.</p><p>LSM trees avoid this by leveraging <strong>sequential writes</strong>, making write operations extremely fast. But there’s a tradeoff—<strong>read performance</strong>. Since records are spread across multiple levels, a read operation might need to scan through several files until it finds the desired record.</p><p><em>Read more about LSM <a href=https://en.wikipedia.org/wiki/Log-structured_merge-tree>here</a></em>.</p><hr><h2 id=what-makes-parrot-different>What Makes Parrot Different?</h2><p>Parrot isn’t just another LSM tree engine. It includes several optimizations aimed at speeding up I/O and improving concurrency.</p><ul><li><p><strong>Chain of Memtables</strong><br>What happens to writes while flushing the memtable? Many systems use a double-buffered approach—write to one while flushing the other. But if the second also fills up before flushing completes, things get messy.<br>Parrot uses a <strong>chain of memtables</strong>, where new memtables are continuously added to a queue. The flusher works independently, flushing from the other end of the queue, enabling uninterrupted writes.</p></li><li><p><strong>Optimistic Concurrency Control</strong><br>Parrot minimizes locking, using optimistic strategies for concurrent writes and reads.</p></li><li><p><strong>Zero-Copy Reads</strong><br>Parrot uses <strong>shared memory mapping (mmap)</strong> to read files. It avoids copying file data to user-space buffers; threads read directly from the kernel page cache, reducing latency and memory usage.</p></li></ul><p><figure><img src=lsm2.png alt=Screenshot loading=lazy><figcaption>Screenshot</figcaption></figure></p><hr><h2 id=introducing-orangedb>Introducing <strong>OrangeDB</strong></h2><p><strong>Orange</strong> is a distributed key-document database built on top of Parrot. It provides:</p><ul><li>SQL-like interface via <strong>OQL</strong></li><li>Native JSON-like document encoding</li><li>Rich set of data types</li><li>Sharding and replication out of the box</li></ul><hr><h2 id=sharding-consistency-and-replication>Sharding, Consistency, and Replication</h2><p>OrangeDB combines the architectures of <strong>MongoDB</strong> and <strong>Cassandra</strong>, striking a balance between high availability and consistency.</p><p>An Orange cluster consists of three main components:</p><ul><li><p><strong>Router</strong><br>Uses <strong>consistent hashing</strong> to route queries to the appropriate shard. It also supports a concept we call <em>&ldquo;consistent ring within a consistent ring&rdquo;</em> to map keys precisely to replicas.</p></li><li><p><strong>Shard</strong><br>A group of replicas (or &ldquo;siblings&rdquo;) running OrangeDB instances. These replicas use a <strong>leaderless</strong> model—any replica that receives a write replicates it to others, similar to Cassandra’s gossip-style replication.</p></li><li><p><strong>Operator</strong><br>A custom Kubernetes Operator for deploying and managing OrangeDB clusters.</p></li></ul><h4 id=read-consistency-levels>Read Consistency Levels</h4><p>OrangeDB supports configurable read strategies:</p><ul><li><p><strong>all</strong><br>Queries <strong>all siblings</strong> of a shard and requires <strong>unanimous agreement</strong> on the value.<br>If any replica is out of sync, the read fails.<br>This mode provides <strong>strong consistency</strong>, but may have higher latency.</p></li><li><p><strong>quorum</strong><br>Queries all siblings but only requires a <strong>majority to agree</strong> on the value.<br>Offers a balance between consistency and availability.<br>Can optionally trigger <strong>read repair</strong> to sync outdated replicas.</p></li><li><p><strong>single</strong><br>Queries only the <strong>primary replica</strong> responsible for the key.<br>This is the <strong>fastest</strong> mode but assumes the primary is <strong>alive and up-to-date</strong>.<br>Suitable when you need <strong>strong consistency</strong> with <strong>low latency</strong>, but <em>primary node</em> is a <em>single point of failure</em>.</p></li></ul><h2 id=deployment-options>Deployment Options</h2><p>OrangeDB is available in multiple flavors.</p><h3 id=standalone-mode>Standalone Mode</h3><p>Run a single OrangeDB instance with gRPC endpoints. Use the Go client to send OQL or gRPC-based queries.</p><pre tabindex=0><code>app % orange server --port 8000
  ___                             
 / _ \ _ __ __ _ _ __   __ _  ___ 
| | | | &#39;__/ _&#39; | &#39;_ \ / _&#39; |/ _ \
| |_| | | | (_| | | | | (_| |  __/
 \___/|_|  \__,_|_| |_|\__, |\___|
                       |___/      
Running project: `orange`
Starting server at 127.0.0.1:8000 
</code></pre><p>You can interact with it using the REPL:</p><pre tabindex=0><code>app % orange repl --port 8000 --address localhost
# Welcome to orange
&gt; SELECT * FROM users WHERE _ID = 10
</code></pre><h3 id=sharded-cluster-on-kubernetes>Sharded Cluster on Kubernetes</h3><p>Step 1: Deploy OrangeDB Operator</p><pre tabindex=0><code>kubectl apply -f https://raw.githubusercontent.com/nagarajRPoojari/orangectl/main/dist/install.yaml
</code></pre><p>Step 2: Define Orange Cluster</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># orange.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>ctl.orangectl.orange.db/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>OrangeCtl</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>orangectl-sample</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>orangectl</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/managed-by</span>: <span style=color:#ae81ff>kustomize</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>router</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>router</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>orange-router</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>control</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>np137270/gateway:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ROUTING_MODE</span>: <span style=color:#e6db74>&#34;hash&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>LOG_LEVEL</span>: <span style=color:#e6db74>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>shard</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shard</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>orange-shard</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>np137270/orange:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>count</span>: <span style=color:#ae81ff>2</span>                <span style=color:#75715e># Number of shards</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>             <span style=color:#75715e># Replicas per shard</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>52001</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>STORAGE_PATH</span>: <span style=color:#e6db74>&#34;/app/data&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CACHE_ENABLED</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><pre tabindex=0><code>kubectl apply -f orange.yaml
kubectl port-forward svc/router 8000:8000
</code></pre><p>Step 3: Try Some Queries</p><pre tabindex=0><code>echo &#34;Creating schema...&#34;
curl -X POST http://localhost:8000/  \
     -H &#34;Content-Type: application/json&#34; \
     -d &#39;{&#34;query&#34;: &#34;create document test {\&#34;name\&#34;:\&#34;STRING\&#34;}&#34;}&#39;

echo &#34;Inserting documents from ID 1 to 20...&#34;
for i in $(seq 1 20); do
  curl -s -X POST http://localhost:8000/ \
       -H &#34;Content-Type: application/json&#34; \
       -d &#34;{\&#34;query\&#34;: \&#34;insert value into test  {\\\&#34;_ID\\\&#34;: $i, \\\&#34;name\\\&#34;: \\\&#34;hello-$i\\\&#34;}\&#34;}&#34;
done

echo &#34;Searching for document with _ID = 13...&#34;
curl -X POST http://localhost:8000/  \
     -H &#34;Content-Type: application/json&#34; \
     -d &#39;{&#34;query&#34;: &#34;select * from test where _ID = 13&#34;}&#39;
</code></pre><h2 id=whats-next>What&rsquo;s Next?</h2><p>OrangeDB is still evolving. We&rsquo;re working on:</p><ul><li>Transaction support</li><li>Better indexing strategies</li><li>Integration with stream processing engines</li></ul><p>Feedback, contributions, and critiques are welcome.</p><div class=time><time datetime=2025-08-16>2025-08-16&nbsp;</time></div><div class=comments></div><div class=terminal-nav><div class=back-nav><a href=/opennotes/posts/ class=back-link>../</a></div></div></main><footer><p>&copy; Copyright 2026 &#183;
<a href=https://github.com/ntk148v/shibui>shibui</a></p></footer></body></html>